# Open Networking FRR Labs

This repository provides a **repeatable, lab-as-code framework** for experimenting with **open networking control-plane behavior** using:

- **FRR (Free Range Routing)** as the routing control plane  
- **Docker + Docker Compose**  
- **Docker Compose created for each lab build**  
- **Per-lab configuration trees generated by Python**  

The design mirrors how modern **open network operating systems** (SONiC, Cumulus Linux, SR Linux) operate internally:

- **Configuration files as the source of truth**  
- **Routing control plane separated from the data plane**  
- **CLI as an optional interface, not a requirement**  

---

## Repository Layout

```text
.
├── build_frr_lab.py             # Lab generator script
└── labs/
    └── lab1/
        ├── docker-compose.yml   # Lab-specific docker compose file
        ├── .env                 # Lab-specific environment variables
        └── frr/
            ├── spine1/
            │   ├── daemons
            │   ├── frr.conf
            │   └── vtysh.conf
            ├── leaf1/
            └── leaf2/
```

---

## Prerequisites

**Operating System:**  
macOS or Linux (Docker Desktop supported)  

**Required Software:**

- Docker Desktop  
- Docker Compose v2 (`docker compose`)  
- Python 3.9+  

**Verify Prerequisites:**

```sh
docker version
docker compose version
python3 --version
```

_If `docker compose` is not available, update Docker Desktop._

---

## Clone the Repository

```sh
git clone <your-repo-url>
cd OpenNetOs   # or your repo directory name
```

---

## Quick Start (TL;DR)
```sh
python3 build_frr_lab.py --lab labs/lab1 --spines 1 --leafs 2 --up
docker exec -it lab1-spine1 vtysh -c "show ip bgp summary"
```

---

## How the System Works (High-Level)

- `build_frr_lab.py` generates:
  - FRR configuration directories per node
  - A lab-specific `.env` file

- `docker-compose.yml`:
  - Created for each lab build
  - Uses variables from `.env` to mount the correct config

- FRR loads configuration from `/etc/frr` at container startup

- `vtysh` is used only for verification/troubleshooting

---

## Step 1: Generate a Lab

From the repository root, run:

```sh
python3 build_frr_lab.py --lab labs/lab1 --spines 1 --leafs 2 --up
```

**What This Does:**

- Creates `labs/lab1/frr/<node>/`
- Generates:
  - `daemons`
  - `frr.conf`
  - `vtysh.conf`
- Generates `labs/lab1/.env` with:
  - `LAB_NAME`
  - `FRR_DIR=./labs/lab1/frr`
  - IP assignments per node
- Runs the docker compose "up" command to initiate the containers

---

### Default Topology

| Node   | Role  | IP Address     | ASN   |
|--------|-------|----------------|-------|
| spine1 | Spine | 172.20.0.11    | 65000 |
| leaf1  | Leaf  | 172.20.0.12    | 65101 |
| leaf2  | Leaf  | 172.20.0.13    | 65102 |

_This is a classic eBGP leaf–spine underlay, matching modern data center fabrics._

---

## Step 2: Start the Lab manually

From the repository root:

```sh
docker compose --env-file labs/lab1/.env -f /labs/lab1/docker-compose.yml up -d
```

**Check Status:**

```sh
docker compose ps
```

_All nodes should be in a running state._

---

## Step 3: Access the Nodes

Enter a container shell:

```sh
docker exec -it lab1-spine1 bash
```

Start the FRR CLI:

```sh
vtysh
```

---

## Step 4: Verify BGP

From `spine1`:

```sh
show ip bgp summary
```

_Expected result: Neighbors leaf1 and leaf2 are Established_

From a leaf:

```sh
docker exec -it lab1-leaf1 vtysh -c "show ip bgp summary"
```

---

## How Configuration Works

- Each container mounts `/etc/frr` from:  
  `labs/<lab>/frr/<node>`

- FRR daemons start automatically at container startup

- Configuration is loaded from `frr.conf`

- `vtysh` is optional and used for inspection only

---

## Making Changes

1. Edit `labs/lab1/frr/<node>/frr.conf`
2. Restart the lab:

```sh
docker compose down
docker compose up -d
```

---

## Running Multiple Labs

Create another lab:

```sh
python3 build_frr_lab.py --lab labs/lab2 --spines 2 --leafs 4 --up
```

Start it manually:

```sh
docker compose --env-file labs/lab2/.env -f /labs/lab2/docker-compose.yml up -d
```

_Multiple labs can run side-by-side as long as subnets differ._

---

## Stopping a Lab

```sh
ddocker compose --env-file labs/lab1/.env -f /labs/lab1/docker-compose.yml down
```

---

## Cleanup 

**Remove containers and networks:**

```sh
docker compose --env-file labs/lab1/.env -f /labs/lab1/docker-compose.yml down --remove-orphans
```

**Remove generated lab files:**

```sh
rm -rf labs/lab1
```

---

## Design Principles

- **Multiple labs can run and each lab is independent**
- **Config-as-code**
- **No hard-coded lab paths**
- **Lab-specific state isolated under `labs/`**
- **Architecture aligned with real open-NOS platforms**